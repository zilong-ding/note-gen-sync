# é¡¹ç›®èƒŒæ™¯

æ™ºèƒ½å¯¹è¯ç³»ç»Ÿï¼ˆå¦‚èŠå¤©æœºå™¨äººã€æ™ºèƒ½è¯­éŸ³åŠ©æ‰‹ï¼‰ã€æœç´¢å¼•æ“å’Œå‚ç›´é¢†åŸŸé—®ç­”ç³»ç»Ÿçš„æ ¸å¿ƒã€‚

ä¸æ˜¯é—²èŠåŠ©æ‰‹ï¼Œç†è§£æŸ¥è¯¢æ„å›¾ï¼Œå¹¶å°†å…¶è½¬åŒ–ä¸ºè®¡ç®—æœºå¯ä»¥ç²¾ç¡®å¤„ç†å’Œæ‰§è¡Œçš„ç»“æ„åŒ–æ•°æ®ã€‚

## è¾“å…¥å’Œè¾“å‡º

åŸå§‹è¾“å…¥ï¼ˆtextï¼‰: â€œæŸ¥è¯¢è®¸æ˜Œåˆ°ä¸­å±±çš„æ±½è½¦ã€‚â€

è¯­ä¹‰è§£æè¾“å‡ºï¼ˆStructured Dataï¼‰:

```

intentï¼š æ„å›¾ ï¼ˆç”¨æˆ·æé—®çš„ç±»å‹ï¼‰
QUERYï¼ˆæŸ¥è¯¢ï¼‰ã€BOOKï¼ˆé¢„è®¢ï¼‰ã€CANCELï¼ˆå–æ¶ˆï¼‰ã€COMPAREï¼ˆå¯¹æ¯”ï¼‰
domainï¼š é¢†åŸŸ
slotsï¼šæ§½ä½ï¼ˆå®ä½“ï¼‰
{ â€œDestâ€: â€œä¸­å±±â€, â€œSrcâ€: â€œè®¸æ˜Œâ€ }
```

ç»“æ„åŒ–æŸ¥è¯¢

```

SELECT * FROM bus_schedule WHERE src = 'è®¸æ˜Œ' AND dest = 'ä¸­å±±';
```

ç»„ç»‡ä¸ºè‡ªç„¶è¯­è¨€ -ã€‹ è¾“å‡º

## é¡¹ç›®äº§å‡ºï¼ˆä¸€ä¸ªå¯éƒ¨ç½²ã€å¯è°ƒç”¨ã€é«˜å‡†ç¡®ç‡çš„XXé¢†åŸŸåŠ©æ‰‹ï¼‰

æ™ºèƒ½å¯¹è¯åŠ©æ‰‹ï¼ˆæ™ºèƒ½ä½“ï¼‰æ¥æ”¶ç”¨æˆ·çš„è‡ªç„¶è¯­è¨€è¾“å…¥ï¼Œå¹¶è¾“å‡ºç»“æ„åŒ–çš„ã€æœºå™¨å¯è¯»çš„æ•°æ®ï¼Œä»¥ä¾¿åç»­ç³»ç»Ÿæ‰§è¡Œç²¾ç¡®çš„æŸ¥è¯¢ã€‚

## é¡¹ç›®æŠ€æœ¯è·¯çº¿

- BERTï¼ˆå¾®è°ƒï¼‰ï¼šæ„å›¾è¯†åˆ« + å®ä½“è¯†åˆ«
- GPTï¼ˆæç¤ºè¯ã€ååºå¯ä»¥è€ƒè™‘å¾®è°ƒï¼‰ï¼šå¤§æ¨¡å‹è¯†åˆ«æ„å›¾ + å®ä½“

## é¡¹ç›®æ—¶é—´è½´

1M


# æŠ€æœ¯æ–¹æ¡ˆ

## ä¸šåŠ¡é€»è¾‘

![2025-09-27_10-03.jpg](https://cdn.jsdelivr.net/gh/zilong-ding/note-gen-image-sync@main/f88f016d-2215-4b43-a90f-9a28878703cc.jpeg)


## å®æ–½æ–¹æ¡ˆ

## âœ… å¢å¼ºç‰ˆå®æ–½æ–¹æ¡ˆï¼ˆæ€»å‘¨æœŸï¼š3~4 å‘¨ï¼‰

### é˜¶æ®µ 1ï¼šæ•°æ®æ„å»ºä¸éªŒè¯ï¼ˆ7å¤©ï¼‰âœ… **å…³é”®ï¼å†³å®šä¸Šé™**


| ä»»åŠ¡                | è¯¦ç»†è¯´æ˜                                                                                                                                     | äº¤ä»˜ç‰©                                               | é£é™©æ§åˆ¶         |
| ------------------- | -------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------- | ---------------- |
| **1.1 å®šä¹‰ Schema** | æ˜ç¡® 4 æ„å›¾ + 8 æ§½ä½<br />ï¼ˆå«å¤šå€¼`VehicleType`ï¼‰ï¼Œ<br />åˆ¶å®š BIO æ ‡ç­¾ä½“ç³»                                                                   | `schema.json`ï¼ˆå« intent/slot å®šä¹‰ï¼‰                 | é¿å…åæœŸæ§½ä½å˜æ›´ |
| **1.2 æ•°æ®é‡‡é›†**    | - çœŸå®ç”¨æˆ·æ—¥å¿—ï¼ˆå¦‚æœ‰ï¼‰<br>- <br />æ¨¡æ¿ç”Ÿæˆ<br />ï¼ˆâ€œæŸ¥{Src}åˆ°{Dest}<br />çš„{Vehicle}â€ï¼‰<br>- <br />äººå·¥ç¼–å†™ï¼ˆè¦†ç›–å£è¯­ã€<br />é”™åˆ«å­—ã€çœç•¥ï¼‰ | åŸå§‹è¯­æ–™åº“<br />ï¼ˆâ‰¥3000 æ¡ï¼‰                        | è¦†ç›–é•¿å°¾è¡¨è¾¾     |
| **1.3 æ ‡æ³¨ä¸è´¨æ£€**  | - ä½¿ç”¨ Label Studio æ ‡æ³¨<br>- <br />æŒ‰å­—åˆ‡åˆ† + <br />BIO æ ‡æ³¨<br>- <br />åŒäººæ ¡éªŒï¼ˆKappa â‰¥ 0.8ï¼‰                                            | æ ‡æ³¨æ•°æ®é›†<br />ï¼ˆJSONL æ ¼å¼ï¼‰                       | é¿å…æ ‡æ³¨å™ªå£°     |
| **1.4 æ•°æ®åˆ’åˆ†**    | Train: 70%, Dev: 15%, <br />Test: 15%ï¼ˆæŒ‰æ„å›¾åˆ†å±‚æŠ½æ ·ï¼‰                                                                                      | `train.jsonl`, <br />`dev.jsonl`, <br />`test.jsonl` | ç¡®ä¿å„æ„å›¾å‡è¡¡   |

> ğŸ“Œ **å»ºè®®**ï¼šä¼˜å…ˆä¿è¯ **BOOK / QUERY** æ•°æ®è´¨é‡ï¼ˆé«˜é¢‘æ„å›¾ï¼‰ï¼ŒCOMPARE / CANCEL å¯ç¨å°‘ã€‚

---

### é˜¶æ®µ 2ï¼šæ¨¡å‹é€‰å‹ä¸è®­ç»ƒï¼ˆ10~12å¤©ï¼‰âœ… **æ ¸å¿ƒï¼šéªŒè¯å“ªç§æ–¹æ¡ˆæ€§ä»·æ¯”æœ€é«˜**

#### æŠ€æœ¯è·¯çº¿å¯¹æ¯”ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰


| æ–¹æ¡ˆ                                                            | ä¼˜ç‚¹                                                                     | ç¼ºç‚¹                                                    | é€‚ç”¨åœºæ™¯                         | æ¨èæŒ‡æ•°   |
| --------------------------------------------------------------- | ------------------------------------------------------------------------ | ------------------------------------------------------- | -------------------------------- | ---------- |
| **A. ç»Ÿä¸€ BERTï¼ˆå¤šä»»åŠ¡ï¼‰**<br>ï¼ˆä½ å·²å®ç°ï¼‰                      | - å…±äº«è¯­ä¹‰ï¼Œå‡†ç¡®ç‡é«˜<br>- å•æ¨¡å‹ï¼Œ<br />éƒ¨ç½²ç®€å•<br>- è®­ç»ƒå¿«ï¼ˆ1~2 å°æ—¶ï¼‰ | éœ€æ ‡æ³¨æ•°æ®                                              | **é¦–é€‰ï¼** æ•°æ® â‰¥1000 æ¡        | â­â­â­â­â­ |
| **B. åŒ BERTï¼ˆç‹¬ç«‹æ¨¡å‹ï¼‰**                                      | æ„å›¾/æ§½ä½è§£è€¦ï¼Œè°ƒè¯•çµæ´»                                                  | æ¨¡å‹å¤§ã€å»¶è¿Ÿé«˜ã€æ•°æ®åˆ©ç”¨ç‡ä½                            | ä¸æ¨èï¼ˆé™¤éæ„å›¾å·®å¼‚æå¤§ï¼‰       | â­â­       |
| **C. å¤§æ¨¡å‹ Promptï¼ˆZero/Few-shotï¼‰**<br>ï¼ˆå¦‚ ChatGLM3 / Qwenï¼‰ | æ— éœ€è®­ç»ƒï¼Œå¿«é€ŸéªŒè¯                                                       | - æˆæœ¬é«˜ï¼ˆAPI/æ¨ç†ï¼‰<br>- è¾“å‡ºä¸ç¨³å®š<br>- éš¾ç»“æ„åŒ–      | ä»…ç”¨äº**åŸºçº¿å¯¹æ¯”**               | â­â­       |
| **D. å¤§æ¨¡å‹å¾®è°ƒï¼ˆLoRAï¼‰**<br>ï¼ˆå¦‚ ChatGLM3-6B + LoRAï¼‰          | å¼ºæ³›åŒ–ï¼Œæ”¯æŒå¤æ‚è¡¨è¾¾                                                     | - æ˜¾å­˜è¦æ±‚é«˜ï¼ˆâ‰¥24Gï¼‰<br>- è®­ç»ƒæ…¢ï¼ˆå¤©çº§ï¼‰<br>- éƒ¨ç½²å¤æ‚ | æ•°æ®æå°‘ï¼ˆ<500ï¼‰æˆ–éœ€æ”¯æŒå¤šè½®å¯¹è¯ | â­â­â­     |

#### âœ… æ¨èæ‰§è¡Œé¡ºåºï¼š

1. **å…ˆè·‘é€šæ–¹æ¡ˆ Aï¼ˆç»Ÿä¸€ BERTï¼‰** â†’ å¿«é€Ÿå¾—åˆ° baselineï¼ˆç¬¬ 3 å¤©å‡ºç»“æœï¼‰
2. **ç”¨æ–¹æ¡ˆ Cï¼ˆå¤§æ¨¡å‹ Promptï¼‰åšå¯¹æ¯”å®éªŒ** â†’ éªŒè¯æ•°æ®è´¨é‡ä¸Šé™
3. **è‹¥ A æ•ˆæœè¾¾æ ‡ï¼ˆIntent Acc > 92%, Slot F1 > 88%ï¼‰ï¼Œåˆ™æ”¾å¼ƒ C/D**
4. **ä»…å½“ A æ•ˆæœå·®ä¸”æ•°æ®æå°‘æ—¶ï¼Œè€ƒè™‘ Dï¼ˆå¤§æ¨¡å‹å¾®è°ƒï¼‰**

#### è®­ç»ƒè®¡åˆ’ï¼ˆä»¥æ–¹æ¡ˆ A ä¸ºä¸»ï¼‰ï¼š


| å¤©æ•°     | ä»»åŠ¡                                              |
| -------- | ------------------------------------------------- |
| ç¬¬1å¤©    | æ­å»ºç»Ÿä¸€ BERT å¤šä»»åŠ¡ä»£ç ï¼ˆä½¿ç”¨ä½ ä¿®æ­£åçš„æ¨¡å‹ï¼‰    |
| ç¬¬2å¤©    | æ•°æ®é¢„å¤„ç†ï¼ˆtokenizer å¯¹é½ã€paddingã€label æ˜ å°„ï¼‰ |
| ç¬¬3å¤©    | è®­ç»ƒ + åœ¨ dev é›†è°ƒå‚ï¼ˆlr=2e-5, epoch=5ï¼‰          |
| ç¬¬4å¤©    | æµ‹è¯•é›†è¯„ä¼°ï¼ˆIntent Acc, Slot F1, è”åˆå‡†ç¡®ç‡ï¼‰     |
| ç¬¬5å¤©    | é”™è¯¯åˆ†æï¼ˆbad case å½’å› ï¼šæ•°æ®ï¼Ÿæ¨¡å‹ï¼Ÿï¼‰           |
| ç¬¬6-7å¤©  | è¿­ä»£ï¼šè¡¥å……æ•°æ® or è°ƒæ•´æ¨¡å‹ï¼ˆå¦‚åŠ  CRF å±‚ï¼‰         |
| ç¬¬8-10å¤© | å°è¯•å¤§æ¨¡å‹ Prompt åŸºçº¿ï¼ˆå¯é€‰ï¼‰                    |

> ğŸ“Š **è¯„ä¼°æŒ‡æ ‡å¿…é¡»åŒ…å«**ï¼š
>
> - æ„å›¾å‡†ç¡®ç‡ï¼ˆIntent Accuracyï¼‰
> - æ§½ä½ F1-scoreï¼ˆæŒ‰å®ä½“ç±»å‹ï¼‰
> - **ç«¯åˆ°ç«¯å‡†ç¡®ç‡**ï¼ˆIntent æ­£ç¡® **ä¸”** æ‰€æœ‰æ§½ä½æ­£ç¡®ï¼‰

---

### é˜¶æ®µ 3ï¼šä¸šåŠ¡ç³»ç»Ÿæ„å»ºï¼ˆ7~10å¤©ï¼‰âœ… **è®©æ¨¡å‹çœŸæ­£å¯ç”¨**


| æ¨¡å—               | å…³é”®ä»»åŠ¡                                                                                                                              | æŠ€æœ¯æ ˆå»ºè®®                           |
| ------------------ | ------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------ |
| **3.1 åå¤„ç†å¼•æ“** | - BIO â†’ å®ä½“åˆå¹¶<br>- å¤šå€¼æ§½ä½èšåˆï¼ˆVehicleTypeï¼‰<br>- å®ä½“å½’ä¸€åŒ–ï¼ˆâ€œé«˜é“â€â†’â€œtrainâ€ï¼‰<br>- æ—¥æœŸæ ‡å‡†åŒ–ï¼ˆâ€œæ˜å¤©â€â†’â€œ2025-09-28â€ï¼‰ | Python +`cn2an` + `chinese-calendar` |
| **3.2 æŸ¥è¯¢ç”Ÿæˆå™¨** | æ ¹æ® intent + slots ç”Ÿæˆï¼š<br>- SQL æ¨¡æ¿<br>- æˆ–ç»“æ„åŒ– Query å¯¹è±¡ï¼ˆæ¨èï¼‰                                                             | Jinja2 æ¨¡æ¿ / ç­–ç•¥æ¨¡å¼               |
| **3.3 API æœåŠ¡**   | æä¾› HTTP æ¥å£ï¼š<br>`POST /parse {text} â†’ {intent, slots, query}`                                                                    | FastAPI + Uvicorn                    |
| **3.4 éƒ¨ç½²**       | - Docker å®¹å™¨åŒ–<br>- æ¨¡å‹é‡åŒ–ï¼ˆå¯é€‰ï¼‰<br>- å‹æµ‹ï¼ˆQPS â‰¥ 50ï¼‰                                                                          | Docker + Nginx + Prometheus          |
| **3.5 ç›‘æ§ä¸æ—¥å¿—** | è®°å½•è¾“å…¥/è¾“å‡ºã€å»¶è¿Ÿã€é”™è¯¯ç‡                                                                                                           | ELK / è‡ªå®šä¹‰æ—¥å¿—                     |

#### ç¤ºä¾‹ API å“åº”ï¼š

```json
{
  "intent": "BOOK",
  "slots": {
    "Src": "è®¸æ˜Œ",
    "Dest": "ä¸­å±±",
    "Date": "2025-09-28",
    "PassengerCount": 1
  },
  "query": {
    "action": "create_booking",
    "params": { ... }
  }
}
```

---

## ğŸš¦ é£é™©ä¸åº”å¯¹ç­–ç•¥


| é£é™©                             | åº”å¯¹æªæ–½                                                                      |
| -------------------------------- | ----------------------------------------------------------------------------- |
| **æ•°æ®ä¸è¶³å¯¼è‡´æ•ˆæœå·®**           | - å¯åŠ¨æ¨¡æ¿ç”Ÿæˆ + å›è¯‘å¢å¼º<br>- ç”¨å¤§æ¨¡å‹ç”Ÿæˆä¼ªæ ‡ç­¾ï¼ˆéœ€äººå·¥æ ¡éªŒï¼‰               |
| **å¤šå€¼æ§½ä½è¯†åˆ«ä¸å‡†**             | - åœ¨åå¤„ç†ä¸­åŠ å…¥è§„åˆ™å…œåº•ï¼ˆå¦‚â€œå’Œâ€â€œæˆ–â€åˆ†å‰²ï¼‰<br>- å•ç‹¬è¯„ä¼° `VehicleType` F1 |
| **çº¿ä¸Šå»¶è¿Ÿé«˜**                   | - æ¨¡å‹å¯¼å‡ºä¸º ONNX<br>- ä½¿ç”¨ CPU ä¼˜åŒ–ï¼ˆIntel OpenVINOï¼‰                        |
| **æ„å›¾æ··æ·†ï¼ˆQUERY vs COMPAREï¼‰** | - åœ¨è®­ç»ƒæ•°æ®ä¸­å¢åŠ å¯¹æ¯”æ ·æœ¬<br>- è”åˆå‡†ç¡®ç‡ä½œä¸ºæ ¸å¿ƒæŒ‡æ ‡                        |

---

## ğŸ“… æœ€ç»ˆäº¤ä»˜ç‰©æ¸…å•


| ç±»åˆ«     | äº¤ä»˜ç‰©                                                           |
| -------- | ---------------------------------------------------------------- |
| **æ•°æ®** | æ ‡æ³¨æ•°æ®é›†ï¼ˆå« train/dev/testï¼‰ã€schema å®šä¹‰                     |
| **æ¨¡å‹** | è®­ç»ƒå¥½çš„ç»Ÿä¸€ BERT æ¨¡å‹ï¼ˆ.bin + configï¼‰ã€è¯„ä¼°æŠ¥å‘Š                |
| **ä»£ç ** | - æ¨¡å‹è®­ç»ƒè„šæœ¬<br>- åå¤„ç†æ¨¡å—<br>- FastAPI æœåŠ¡<br>- Dockerfile |
| **æ–‡æ¡£** | - API æ¥å£æ–‡æ¡£<br>- éƒ¨ç½²æ‰‹å†Œ<br>- é”™è¯¯ç è¯´æ˜                     |

---

## âœ… æ€»ç»“ï¼šä½ çš„æ–¹æ¡ˆå¦‚ä½•ä¼˜åŒ–ï¼Ÿ


| ä½ çš„åŸè®¡åˆ’                              | å»ºè®®å¢å¼ºç‚¹                                                            |
| --------------------------------------- | --------------------------------------------------------------------- |
| â€œæ„å»ºæ•°æ®é›†ï¼Œ7å¤©â€                     | â†’ ç»†åŒ–ä¸º**é‡‡é›†â†’æ ‡æ³¨â†’è´¨æ£€â†’åˆ’åˆ†** å››æ­¥ï¼Œ<br />å¼ºè°ƒ schema å…ˆè¡Œ      |
| â€œæ¨¡å‹è®­ç»ƒï¼šåŒBERT/ç»Ÿä¸€BERT/å¤§æ¨¡å‹...â€ | â†’**æ˜ç¡®ä¼˜å…ˆçº§**ï¼šç»Ÿä¸€ BERT ä¸ºä¸»ï¼Œ<br />å¤§æ¨¡å‹ä»…ä½œåŸºçº¿                |
| â€œä¸šåŠ¡æ„å»ºâ€                            | â†’ æ‹†è§£ä¸º**åå¤„ç†â†’æŸ¥è¯¢ç”Ÿæˆâ†’APIâ†’éƒ¨ç½²** å››æ¨¡å—ï¼Œ<br />å¼ºè°ƒç»“æ„åŒ–è¾“å‡º |

> ğŸ’¡ **æ ¸å¿ƒåŸåˆ™**ï¼š
> **å°æ­¥å¿«è·‘ï¼Œæ•°æ®é©±åŠ¨ï¼Œå…ˆè·‘é€šå†ä¼˜åŒ–**ã€‚
> ç”¨ **ç»Ÿä¸€ BERT å¤šä»»åŠ¡æ¨¡å‹** ä½œä¸ºä¸»çº¿ï¼Œ7 å¤©å†…å‡ºç¬¬ä¸€ä¸ªå¯æµ‹ç‰ˆæœ¬ï¼Œå†è¿­ä»£ã€‚



# æ•°æ®é›†æ„å»º

```python
# entities.py
CITIES = [
    "åŒ—äº¬", "ä¸Šæµ·", "å¹¿å·", "æ·±åœ³", "æ­å·", "æˆéƒ½", "æ­¦æ±‰", "è¥¿å®‰", "å—äº¬", "å¤©æ´¥",
    "é‡åº†", "è‹å·", "éƒ‘å·", "é•¿æ²™", "é’å²›", "æ²ˆé˜³", "å¤§è¿", "å®æ³¢", "å¦é—¨", "è®¸æ˜Œ",
    "ä¸­å±±", "ä½›å±±", "ä¸œè", "ç æµ·", "æƒ å·", "æ±Ÿé—¨", "è‚‡åº†", "æ±•å¤´", "æ½®å·", "æ­é˜³"
]

VEHICLES = {
    "æ±½è½¦": "bus",
    "å¤§å·´": "bus",
    "ç­è½¦": "bus",
    "ç«è½¦": "train",
    "é«˜é“": "train",
    "åŠ¨è½¦": "train",
    "é£æœº": "plane",
    "èˆªç­": "plane"
}

DATES = ["ä»Šå¤©", "æ˜å¤©", "åå¤©", "å‘¨ä¸€", "å‘¨äºŒ", "å‘¨ä¸‰", "å‘¨å››", "å‘¨äº”", "å‘¨å…­", "å‘¨æ—¥", "ä¸‹å‘¨ä¸€"]
TIMES = ["ä¸Šåˆ", "ä¸‹åˆ", "æ™šä¸Š", "æ—©ä¸Š", "ä¸­åˆ", "9ç‚¹", "10ç‚¹", "15ç‚¹", "18ç‚¹"]
SEAT_TYPES = ["ä¸€ç­‰åº§", "äºŒç­‰åº§", "å•†åŠ¡åº§", "ç¡¬åº§", "è½¯åº§", "å§é“º"]
```

```python
# templates.py
TEMPLATES = {
    "QUERY": [
        "æŸ¥ä¸€ä¸‹{src}åˆ°{dest}çš„{vehicle}ã€‚",
        "æˆ‘æƒ³çœ‹çœ‹{src}å»{dest}æœ‰ä»€ä¹ˆ{vehicle}ã€‚",
        "ä»{src}åˆ°{dest}çš„{vehicle}æœ‰å“ªäº›ï¼Ÿ",
        "æœ‰æ²¡æœ‰{src}åˆ°{dest}çš„{vehicle}ï¼Ÿ",
        "æŸ¥è¯¢{date}{src}åˆ°{dest}çš„{vehicle}ã€‚",
        "{src}åˆ°{dest}çš„{vehicle}ä»€ä¹ˆæ—¶å€™å‘è½¦ï¼Ÿ",
        "å¸®æˆ‘æŸ¥{src}åˆ°{dest}çš„{vehicle}ç¥¨ã€‚",
        "çœ‹çœ‹{src}å»{dest}çš„{vehicle}ã€‚",
        "æˆ‘æƒ³çŸ¥é“{src}åˆ°{dest}çš„{vehicle}ä¿¡æ¯ã€‚",
        "æŸ¥{src}åˆ°{dest}çš„{vehicle}ç­æ¬¡ã€‚"
    ],
    "BOOK": [
        "æˆ‘æƒ³è®¢ä¸€å¼ {date}{src}åˆ°{dest}çš„{vehicle}ç¥¨ã€‚",
        "å¸®æˆ‘é¢„è®¢{date}{time}{src}åˆ°{dest}çš„{vehicle}ã€‚",
        "è®¢ç¥¨ï¼š{src}åˆ°{dest}ï¼Œ{date}ï¼Œ{vehicle}ã€‚",
        "æˆ‘è¦ä¹°{date}ä»{src}åˆ°{dest}çš„{vehicle}ç¥¨ï¼Œ{passenger_count}ä¸ªäººã€‚",
        "é¢„è®¢{src}åˆ°{dest}çš„{vehicle}ï¼Œ{date}å‡ºå‘ï¼Œ{seat_type}ã€‚",
        "å¸®æˆ‘è®¢{date}{src}å»{dest}çš„{vehicle}ï¼Œ{passenger_count}å¼ ã€‚",
        "æˆ‘æƒ³è®¢{date}{time}ä»{src}åˆ°{dest}çš„{vehicle}ï¼Œ{seat_type}ã€‚",
        "è®¢ä¸€å¼ {src}åˆ°{dest}çš„{vehicle}ç¥¨ï¼Œ{date}ï¼Œ{passenger_count}äººã€‚",
        "æˆ‘è¦é¢„è®¢{date}ä»{src}åˆ°{dest}çš„{vehicle}ï¼Œ{seat_type}ã€‚",
        "å¸®æˆ‘è®¢{src}åˆ°{dest}çš„{vehicle}ï¼Œ{date}ï¼Œ{passenger_count}ä¸ªäººã€‚"
    ],
    "COMPARE": [
        "æ¯”è¾ƒä¸€ä¸‹{src}åˆ°{dest}å{vehicle1}å’Œ{vehicle2}å“ªä¸ªå¿«ï¼Ÿ",
        "{src}åˆ°{dest}ï¼Œ{vehicle1}å’Œ{vehicle2}çš„ä»·æ ¼å¯¹æ¯”ã€‚",
        "å¸®æˆ‘å¯¹æ¯”{src}åˆ°{dest}çš„{vehicle1}å’Œ{vehicle2}ã€‚",
        "{src}å»{dest}ï¼Œ{vehicle1}è·Ÿ{vehicle2}å“ªä¸ªä¾¿å®œï¼Ÿ",
        "æ¯”è¾ƒ{src}åˆ°{dest}çš„{vehicle1}ã€{vehicle2}å’Œ{vehicle3}çš„æ—¶é—´ã€‚",
        "æˆ‘æƒ³çŸ¥é“{src}åˆ°{dest}å{vehicle1}å’Œ{vehicle2}æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚",
        "å¯¹æ¯”ä¸€ä¸‹{src}åˆ°{dest}çš„{vehicle1}å’Œ{vehicle2}çš„ç¥¨ä»·ã€‚",
        "{src}åˆ°{dest}ï¼Œ{vehicle1}å’Œ{vehicle2}å“ªä¸ªæ›´æ–¹ä¾¿ï¼Ÿ",
        "å¸®æˆ‘çœ‹çœ‹{src}åˆ°{dest}çš„{vehicle1}å’Œ{vehicle2}æ€ä¹ˆé€‰ã€‚",
        "æ¯”è¾ƒ{date}{src}åˆ°{dest}çš„{vehicle1}å’Œ{vehicle2}ã€‚"
    ],
    "CANCEL": [
        "å–æ¶ˆè®¢å•{booking_id}ã€‚",
        "æˆ‘æƒ³å–æ¶ˆ{src}åˆ°{dest}çš„è®¢å•ï¼Œ{date}çš„ã€‚",
        "å¸®æˆ‘å–æ¶ˆé¢„è®¢ï¼š{src}åˆ°{dest}ï¼Œ{date}ã€‚",
        "å–æ¶ˆæˆ‘çš„{vehicle}ç¥¨ï¼Œ{src}åˆ°{dest}ï¼Œ{date}ã€‚",
        "æˆ‘è¦é€€æ‰{date}ä»{src}åˆ°{dest}çš„{vehicle}ç¥¨ã€‚",
        "å–æ¶ˆè®¢å•ï¼Œ{src}åˆ°{dest}ï¼Œ{date}ã€‚",
        "è¯·å¸®æˆ‘å–æ¶ˆ{booking_id}è¿™ä¸ªè®¢å•ã€‚",
        "æˆ‘æƒ³é€€è®¢{src}åˆ°{dest}çš„{vehicle}ï¼Œ{date}ã€‚",
        "å–æ¶ˆæˆ‘çš„è¡Œç¨‹ï¼š{src}åˆ°{dest}ï¼Œ{date}ã€‚",
        "é€€æ‰{date}{src}åˆ°{dest}çš„{vehicle}ç¥¨ã€‚"
    ]
}
```

```python
# generate_data.py
import random
import json
from itertools import product
from entities import CITIES, VEHICLES, DATES, TIMES, SEAT_TYPES

# åŠ è½½æ¨¡æ¿
from templates import TEMPLATES

def get_random_booking_id():
    return f"BK{random.randint(100000, 999999)}"

def bio_tag(text, entities):
    """ä¸ºæ–‡æœ¬ç”Ÿæˆ BIO æ ‡ç­¾"""
    tokens = list(text)
    labels = ["O"] * len(tokens)
  
    for slot_name, value in entities.items():
        if not value:
            continue
        # å¤„ç†å¤šå€¼æ§½ä½ï¼ˆå¦‚ VehicleTypesï¼‰
        values = value if isinstance(value, list) else [value]
        for v in values:
            start = text.find(v)
            while start != -1:
                labels[start] = f"B-{slot_name}"
                for i in range(1, len(v)):
                    if start + i < len(labels):
                        labels[start + i] = f"I-{slot_name}"
                start = text.find(v, start + 1)
    return labels

def generate_samples():
    samples = []
    intent_counts = {"QUERY": 600, "BOOK": 600, "COMPARE": 400, "CANCEL": 400}
  
    for intent, count in intent_counts.items():
        for _ in range(count):
            # éšæœºé€‰å®ä½“
            src = random.choice(CITIES)
            dest = random.choice([c for c in CITIES if c != src])
            vehicle = random.choice(list(VEHICLES.keys()))
            date = random.choice(DATES)
            time = random.choice(TIMES)
            passenger = random.randint(1, 5)
            seat = random.choice(SEAT_TYPES)
            booking_id = get_random_booking_id()
        
            # ä¸º COMPARE é€‰å¤šä¸ªäº¤é€šå·¥å…·
            if intent == "COMPARE":
                vehicles = random.sample(list(VEHICLES.keys()), k=min(2, len(VEHICLES)))
                template = random.choice(TEMPLATES[intent])
                # æ›¿æ¢ {vehicle1}, {vehicle2}
                text = template.format(
                    src=src, dest=dest, date=date,
                    vehicle1=vehicles[0],
                    vehicle2=vehicles[1] if len(vehicles) > 1 else vehicles[0],
                    vehicle3=random.choice(VEHICLES.keys())  # ç”¨äºä¸‰é€‰é¡¹æ¨¡æ¿
                )
                slots = {
                    "Src": src,
                    "Dest": dest,
                    "Date": date if "date" in template else None,
                    "VehicleTypes": vehicles
                }
            elif intent == "CANCEL":
                if random.random() > 0.5:
                    text = random.choice(TEMPLATES[intent]).format(
                        booking_id=booking_id
                    )
                    slots = {"BookingID": booking_id}
                else:
                    text = random.choice(TEMPLATES[intent]).format(
                        src=src, dest=dest, date=date, vehicle=vehicle
                    )
                    slots = {"Src": src, "Dest": dest, "Date": date}
            else:
                template = random.choice(TEMPLATES[intent])
                text = template.format(
                    src=src, dest=dest, vehicle=vehicle,
                    date=date, time=time,
                    passenger_count=passenger, seat_type=seat
                )
                slots = {
                    "Src": src,
                    "Dest": dest,
                    "VehicleType": vehicle,
                    "Date": date if "date" in template.lower() else None,
                    "Time": time if "time" in template.lower() else None,
                }
                if intent == "BOOK":
                    slots.update({
                        "PassengerCount": str(passenger),
                        "SeatType": seat
                    })
        
            # æ¸…ç† None å€¼
            slots = {k: v for k, v in slots.items() if v is not None}
        
            # ç”Ÿæˆ BIO æ ‡ç­¾
            bio_labels = bio_tag(text, slots)
        
            samples.append({
                "text": text,
                "intent": intent,
                "slots_bio": bio_labels
            })
  
    return samples

if __name__ == "__main__":
    samples = generate_samples()
    print(f"ç”Ÿæˆ {len(samples)} æ¡æ ·æœ¬")
  
    # ä¿å­˜ä¸º JSONL
    with open("train_data.jsonl", "w", encoding="utf-8") as f:
        for sample in samples:
            f.write(json.dumps(sample, ensure_ascii=False) + "\n")
  
    # æ‰“å°ç¤ºä¾‹
    print("\nç¤ºä¾‹ï¼š")
    for i in range(3):
        print(samples[i])
```
